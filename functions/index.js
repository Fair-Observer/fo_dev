(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("@babel/runtime/helpers/defineProperty");var r=e.n(t);const n=require("@babel/runtime/helpers/classCallCheck");var o=e.n(n);const c=require("@babel/runtime/helpers/createClass");var i=e.n(c);const a=require("@babel/runtime/helpers/assertThisInitialized");var u=e.n(a);const l=require("@babel/runtime/helpers/inherits");var s=e.n(l);const p=require("@babel/runtime/helpers/possibleConstructorReturn");var f=e.n(p);const h=require("@babel/runtime/helpers/getPrototypeOf");var m=e.n(h);const y=require("react");var d=e.n(y);const v=require("react-router-dom");const b=[{path:"/",component:function(e){s()(c,e);var t,r,n=(t=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=m()(t);if(r){var o=m()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return f()(this,e)});function c(e){return o()(this,c),n.call(this,e)}return i()(c,[{key:"render",value:function(){return d().createElement("div",null,d().createElement("p",null,"This is the Fair Observer homepage."))}}]),c}(y.Component),exact:!0},{path:"/article/:articleslug",component:function(e){s()(c,e);var t,r,n=(t=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=m()(t);if(r){var o=m()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return f()(this,e)});function c(e){return o()(this,c),n.call(this,e)}return i()(c,[{key:"render",value:function(){return d().createElement("div",null,d().createElement("p",null,"This is the Fair Observer article page."))}}]),c}(y.Component),exact:!0},{path:"/community/:userslug",component:function(e){s()(c,e);var t,r,n=(t=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=m()(t);if(r){var o=m()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return f()(this,e)});function c(e){return o()(this,c),n.call(this,e)}return i()(c,[{key:"render",value:function(){return d().createElement("div",null,d().createElement("p",null,"This is the Fair Observer community page."))}}]),c}(y.Component),exact:!0},{path:"/myfo",component:function(e){s()(c,e);var t,r,n=(t=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=m()(t);if(r){var o=m()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return f()(this,e)});function c(e){return o()(this,c),n.call(this,e)}return i()(c,[{key:"render",value:function(){return d().createElement("div",null,d().createElement("p",null,"This is the Fair Observer dashboard page."))}}]),c}(y.Component),exact:!0}],g=require("browser-or-node");function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m()(e);if(t){var o=m()(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return f()(this,r)}}var R=function(e){s()(r,e);var t=w(r);function r(e){var n;return o()(this,r),(n=t.call(this,e)).componentDidMount=n.componentDidMount.bind(u()(n)),n}return i()(r,[{key:"componentDidMount",value:function(){this.props.setRoute(this.props.route)}},{key:"render",value:function(){return this.props.children}}]),r}(d().Component),P=function(e){s()(n,e);var t=w(n);function n(e){var r;return o()(this,n),(r=t.call(this,e)).state={route:{path:g.isBrowser?window.__FOinitialData__.url:r.props.req.url}},r.setRoute=r.setRoute.bind(u()(r)),r}return i()(n,[{key:"setRoute",value:function(e){this.setState({route:e})}},{key:"render",value:function(){var e=this;return d().createElement("div",{className:"AppDiv"},d().createElement(v.Switch,null,b.map((function(t,n){return d().createElement(v.Route,{key:n,path:t.path,exact:t.exact,render:function(o){var c;return g.isNode?c=o.staticContext.initialData:(c=window.__FOinitialData__,window.__FOinitialPage__),d().createElement(R,{setRoute:e.setRoute,route:t,key:n},d().createElement(t.component,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({path:e.setRoute,initialData:c},o)))}})}))))}}]),n}(y.Component);const x=require("react-dom/server");var j=e.n(x);const E=require("serialize-javascript");var _=e.n(E);const D=require("express");var q=e.n(D);const S=require("cors");var F=e.n(S);const k=require("styled-components"),C=require("firebase-functions"),T=require("firebase-admin");function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}T.initializeApp({credential:T.credential.applicationDefault(),databaseURL:"https://fo-dev.firebaseio.com"});var M=q()();function z(e,t,n,o,c){var i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o);i.url=e.url,i.seodata=c;var a,u=new k.ServerStyleSheet,l={initialData:i};a=j().renderToNodeStream(u.collectStyles(d().createElement(v.StaticRouter,{location:e.url,context:l},d().createElement(P,{req:e})))),u.getStyleTags(),t.set("Cache-Control","public, max-age=600, s-maxage=1200");var s,p,f='<!doctype html>\n    <html lang="en">\n      <head>\n        <meta charset="utf-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1">\n        <link rel="icon" type="image/png" href="/favicon.png?'.concat((new Date).getTime(),'">\n        <meta name="author" content="Fair Observer">  \n        ').concat((s=c,p="https://fairobserver.com","\n    \x3c!-- Primary Meta Tags --\x3e\n    <title>".concat(s.title,'</title>\n    <meta name="title" content="').concat(s.title,'">\n    <meta name="description" content="').concat(s.description,'">\n\n    \x3c!-- Open Graph / Facebook --\x3e\n    <meta property="og:type" content="website">\n    <meta property="og:url" content="').concat(p).concat(s.path,'">\n    <meta property="og:title" content="').concat(s.title,'">\n    <meta property="og:description" content="').concat(s.description,'">\n\n    \x3c!-- Twitter --\x3e\n    <meta property="twitter:url" content=content="').concat(p).concat(s.path,'">\n    <meta property="twitter:title" content="').concat(s.title,'">\n    <meta property="twitter:description" content="').concat(s.description,'">\n  ')),"\n        <script>window.__FOinitialData__ = ").concat(_()(i),';window.__FOinitialPage__ = true<\/script>\n        <style>body {	background-color: lightblue;}</style>\n      </head>\n      <body>\n        <div id="root">');t.write(f),a.pipe(t,{end:!1});var h='</div>\n        <script src="/index_bundle.js?'.concat((new Date).getTime(),'">\n        <\/script>\n      </body>\n    </html>');a.on("end",(function(){t.write(h),t.end()}))}M.use(F()({origin:!0})),M.get("/article/:articleslug",(function(e,t,r){console.log("Article"),console.log(e.params.articleslug),T.firestore().collection("articles").doc(e.params.articleslug).get().then((function(r){var n,o;if(r.exists){var c=r.data();(n=c).type="article",o={title:"".concat(c.title," | Fair Observer"),description:c.short,path:"/article/".concat(e.params.articleslug)}}else n={none:!0,type:"article"};z(e,t,0,n,o)})).catch((function(e){t.send("<!doctype html>\n      <head>\n        <title>Error on Server</title>\n      </head>\n      <h1>Error on Server</h1>\n      <p>".concat(e,"</p>\n    </html>"))}))})),M.get("/community/:userslug",(function(e,t,r){console.log("Community: ",e.params.userslug),T.firestore().collection("community").doc(e.params.userslug).get().then((function(r){var n,o;console.log(r.exists),r.exists?(console.log("Found"),(n=r.data()).type="community",o={title:"Fair Observer",description:"A Fair Observer community member",path:"/community/".concat(e.params.userslug)}):n={none:!0,type:"community"},z(e,t,0,n,o)})).catch((function(e){t.send("<!doctype html>\n      <head>\n        <title>Error on Server</title>\n      </head>\n      <h1>Error on Server</h1>\n      <p>".concat(e,"</p>\n    </html>"))}))})),M.get("*",(function(e,t,r){console.log("Generic"),z(e,t,0,{},{title:"Fair Observer",description:"Citizen Jounalism",path:"/"})})),exports.httpServer=C.https.onRequest(M)})();